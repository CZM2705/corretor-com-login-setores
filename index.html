<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corretor de Relatórios - Colégio Santa Úrsula</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
        .hidden { display: none; }
        .prose-custom { color: #374151; }
        .prose-custom h3 { color: #1F2937; font-weight: 600; }
        .prose-custom ul { list-style-position: inside; }
        .prose-custom li::marker { color: #15803d; }
        .card { transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="text-gray-800">

    <!-- 1. TELA DE LOGIN -->
    <div id="login-screen" class="min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4">
        <div class="max-w-md w-full text-center bg-white p-8 sm:p-12 rounded-2xl shadow-md">
            <img src="https://www.colegiosantaursula.com.br/assets_santa/img/santaursula.svg" alt="Logo do Colégio Santa Úrsula" class="mx-auto mb-8 h-20 w-auto">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Corretor de Relatórios</h1>
            <p class="mt-6 text-gray-500">Por favor, faça login com sua conta institucional para continuar.</p>
            <button id="login-button" class="mt-8 w-full inline-flex justify-center items-center gap-3 bg-white py-3 px-6 border border-gray-300 rounded-xl shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 transition-transform transform hover:scale-105">
                <svg class="h-5 w-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><path fill="currentColor" d="M488 261.8C488 403.3 381.5 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 126 21.2 174 55.8L373.5 119.8C340.6 91.2 297.4 73.8 248 73.8c-102.3 0-185.2 82.9-185.2 182.2s82.9 182.2 185.2 182.2c107.4 0 166.9-77.2 172.9-119.8H248v-66.3h239.1c1.3 12.8 2.2 25.8 2.2 39.3z"></path></svg>
                Entrar com Google
            </button>
            <p id="login-error" class="mt-4 text-red-500 font-medium hidden"></p>
        </div>
    </div>

    <!-- 2. TELA DE SELEÇÃO PRINCIPAL (PROGRAMA) -->
    <div id="main-selection-screen" class="min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4 hidden">
        <header class="absolute top-0 left-0 right-0 bg-white shadow-sm">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <p class="text-sm text-gray-600">Bem-vindo(a), <span class="user-name-display font-semibold"></span>!</p>
                <button class="logout-button text-sm font-medium text-green-700 hover:text-green-900">Sair</button>
            </div>
        </header>
        <div class="text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Selecione o Programa</h2>
            <p class="text-lg text-gray-500 mb-10">Escolha o programa para o qual deseja corrigir um relatório.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                <div id="program-regular" class="card cursor-pointer bg-white p-8 rounded-2xl shadow-md text-center">
                    <i class="fa-solid fa-graduation-cap text-5xl text-green-700 mb-4"></i>
                    <h3 class="text-2xl font-bold text-gray-800">Regular</h3>
                </div>
                <div id="program-international" class="card cursor-pointer bg-white p-8 rounded-2xl shadow-md text-center">
                    <i class="fa-solid fa-earth-americas text-5xl text-green-700 mb-4"></i>
                    <h3 class="text-2xl font-bold text-gray-800">Educação Internacional e Integral Bilíngue</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. TELA DE SELEÇÃO DE SUBGRUPO -->
    <div id="subgroup-selection-screen" class="min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4 hidden">
         <header class="absolute top-0 left-0 right-0 bg-white shadow-sm">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <button id="back-to-main" class="text-sm font-medium text-green-700 hover:text-green-900 flex items-center gap-2"><i class="fa-solid fa-arrow-left"></i>Voltar</button>
                <p class="text-sm text-gray-600">Bem-vindo(a), <span class="user-name-display font-semibold"></span>!</p>
                <button class="logout-button text-sm font-medium text-green-700 hover:text-green-900">Sair</button>
            </div>
        </header>
        <div class="text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Selecione o Currículo</h2>
            <p class="text-lg text-gray-500 mb-10">Para qual área é o relatório?</p>
            <div id="subgroup-selection-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>
    </div>

    <!-- 4. TELA DE SELEÇÃO DE SETOR FINAL -->
    <div id="sector-selection-screen" class="min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4 hidden">
         <header class="absolute top-0 left-0 right-0 bg-white shadow-sm">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <button id="back-to-previous-from-sector" class="text-sm font-medium text-green-700 hover:text-green-900 flex items-center gap-2"><i class="fa-solid fa-arrow-left"></i>Voltar</button>
                <p class="text-sm text-gray-600">Bem-vindo(a), <span class="user-name-display font-semibold"></span>!</p>
                <button class="logout-button text-sm font-medium text-green-700 hover:text-green-900">Sair</button>
            </div>
        </header>
        <div class="text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Selecione a Turma</h2>
            <p class="text-lg text-gray-500 mb-10">Para qual turma/matéria é o relatório?</p>
            <div id="sector-selection-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>
    </div>


    <!-- 5. APLICAÇÃO PRINCIPAL -->
    <div id="app-screen" class="hidden">
        <header class="bg-white shadow-sm">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                 <button id="back-to-sector-selection" class="text-sm font-medium text-green-700 hover:text-green-900 flex items-center gap-2"><i class="fa-solid fa-arrow-left"></i>Trocar Turma</button>
                <p class="text-sm text-gray-600">Bem-vindo(a), <span class="user-name-display font-semibold"></span>!</p>
                <button class="logout-button text-sm font-medium text-green-700 hover:text-green-900">Sair</button>
            </div>
        </header>
        <div class="container mx-auto px-4 py-8 md:py-12">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Corretor de Relatórios: <span id="sector-title" class="text-green-800"></span></h2>
            <main class="max-w-4xl mx-auto">
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="mb-6">
                        <label for="api-key" class="block text-lg font-semibold text-gray-700 mb-2">Sua Chave de API do Gemini:</label>
                        <input type="password" id="api-key" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500" placeholder="Cole sua chave de API aqui">
                        <p class="text-sm text-gray-500 mt-2">Sua chave é salva no seu navegador. Obtenha em <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-green-700 hover:underline">aistudio.google.com</a>.</p>
                    </div>
                    <div class="border-t border-gray-200 my-6"></div>
                    <div class="mb-6">
                        <label for="report-text" class="block text-lg font-semibold text-gray-700 mb-2">Relatório do Aluno:</label>
                        <textarea id="report-text" rows="12" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500" placeholder="Cole o texto do relatório aqui..."></textarea>
                    </div>
                    <div class="text-center">
                        <button id="analyze-button" class="bg-green-800 text-white font-bold py-3 px-8 rounded-xl hover:bg-green-900 focus:outline-none focus:ring-4 focus:ring-green-300 transition-transform transform hover:scale-105">Analisar Relatório</button>
                    </div>
                </div>
                <div id="results-container" class="mt-10 bg-white p-6 md:p-8 rounded-2xl shadow-lg hidden">
                    <div id="loading-indicator" class="text-center hidden">
                        <div class="flex justify-center items-center"><svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-green-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-lg font-medium text-gray-600">Analisando...</span></div>
                    </div>
                    <div id="suggestions" class="prose prose-custom max-w-none"></div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Módulos do Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

      // --- CONFIGURAÇÃO ---
      const firebaseConfig = {
        apiKey: "AIzaSyCHlvNnopglq7Y8glXo8rUYU-Hn1lR7YTk",
        authDomain: "corretor-com-login-fafbilingue.firebaseapp.com",
        projectId: "corretor-com-login-fafbilingue",
        storageBucket: "corretor-com-login-fafbilingue.firebasestorage.app",
        messagingSenderId: "724149401323",
        appId: "1:724149401323:web:fdf14d941e5cc84db2b0ae"
      };
      const SCHOOL_DOMAIN = "ursulinebrazil.com"; // Verifique se este é o domínio correto

      // --- ESTRUTURA DOS SETORES E PROMPTS ---
      const programs = {
        regular: {
          title: "Regular",
          sectors: {
            bercario: { 
                title: "Berçário", 
                icon: "fa-baby-carriage",
                prompt: `
                    Você é um assistente para professores. Analise o seguinte relatório de um aluno e forneça sugestões construtivas.
                    Sua análise deve focar nos seguintes pontos:
                    1. **Ortografia e Gramática:** Identifique e corrija quaisquer erros.
                    2. **Pontuação:** Verifique o uso correto de vírgulas, pontos finais, etc.
                    3. **Tempos Verbais:** Garanta a consistência e o uso adequado dos tempos verbais.
                    4. **Clareza e Coerência:** Sugira melhorias para tornar o texto mais claro e coeso.
                    5. **Sugestões Positivas:** Ofereça feedback construtivo e sugestões para enriquecer o relatório.
                    Formate a sua resposta usando Markdown. Use títulos para cada seção (ex: ### Ortografia e Gramática).
                `
            },
            infantil1e2: { title: "Infantil 1 e 2", icon: "fa-shapes", prompt: `PROMPT PARA INFANTIL 1 E 2` },
            infantil3: { title: "Infantil 3", 
                        icon: "fa-puzzle-piece", 
                        prompt: ` Você é um assistente para professores. Analise o seguinte relatório de um aluno e forneça sugestões construtivas.
            Sua análise deve focar nos seguintes pontos:
            1.  **Ortografia e Gramática:** Identifique e corrija quaisquer erros.
            2.  **Pontuação:** Verifique o uso correto de vírgulas, pontos finais, etc.
            3.  **Tempo Verbal e Impessoalidade:** Verifique se o texto usa verbos predominantemente no passado e em formato impessoal. Se encontrar desvios, aponte e sugira a alteração. Exemplo: "No trecho 'eu percebo que ele participa', sugira uma alternativa impessoal e no passado, como 'foi observado que o aluno participou'".
            4.  **Clareza e Coerência:** Sugira melhorias para tornar o texto mais claro e coeso.
            5.  **Sugestões Positivas:** Ofereça feedback construtivo e sugestões para enriquecer o relatório.
			6. **Abrangência das Áreas:** Confirme se o texto aborda todas as áreas do conhecimento necessárias: linguagem, matemática, educação cósmica contemplando ciências, história e geografia, interações sociais, educação nutricional, arte e projetos. Se alguma área estiver ausente, aponte qual.
			7. **Na finalização do relatório, sugira que contenha fatos relevantes e uma conclusão de como foi o trimestre. 

            Formate a sua resposta usando Markdown. Use títulos para cada seção (ex: ### Ortografia e Gramática).
            Texto para análise:
 ` },
            fundamentalIniciais: { title: "Atas", 
								  icon: "fa-book-open-reader", 
								  prompt: `
Você é um assistente pedagógico especializado em revisar Atas de Reunião preparatórias. Sua tarefa é analisar a ATA a seguir e fornecer SUGESTÕES PONTUAIS para garantir que ela seja clara, completa e profissional para a reunião com a família ou especialista. O objetivo é guiar o professor, não fazer o trabalho por ele.

**PRINCÍPIOS FUNDAMENTAIS:**
1.  **Não Rotular:** Evite qualquer linguagem que possa rotular o aluno (ex: "birrento", "fraco", "agressivo", "agitado"). Foque em descrever comportamentos observáveis (ex: "apresentou dificuldade em controlar impulsos", "necessidade de aprimoramento"). 
2. 	**Para temas sensíveis (agitação, agressividade, isolamento), a orientação é ainda mais crucial: em vez de afirmar que "o aluno é agitado", sua sugestão deve ser para que o professor descreva o contexto e a ação. Por exemplo, aponte o trecho e sugira: "Aqui, em vez de classificar o comportamento, procure descrever a situação que o motivou. Exemplo: 'Durante atividades em grupo que exigem espera, foi observado que o aluno se levantou da cadeira repetidas vezes, balançou as mãos e teve dificuldade em aguardar sua vez de falar.
3.  **Clareza e Objetividade:** As sugestões devem visar um texto claro, direto ao ponto e sem jargões complexos, facilitando a compreensão por parte da família.
4.  ** Não utilizar o termo "apesar desses progressos". 
---

Analise a ATA sob os seguintes critérios e formate a resposta em Markdown:

### Análise Estrutural e de Conteúdo
- **Origem da Reunião:** Verifique se o primeiro parágrafo informa claramente quem solicitou a reunião (escola, família ou especialista). Se faltar, sugira a adição.
- ** - Estrutura das Áreas do Conhecimento: Verifique se a ata aborda de forma agrupada e única as áreas necessárias: linguagem, matemática, educação cósmica (ciências, história e geografia) e interações sociais. As observações sobre essas áreas devem estar concentradas em uma única seção da ata, não espalhadas por vários parágrafos. Se alguma área estiver ausente ou se estiverem repetidas em diferentes partes do texto, aponte a necessidade de centralizar essa análise. 
- **Contexto e Progresso:** A ata precisa conter observações que relacionem o tempo de concentração com a idade da criança, além dos conteúdos e objetivos trabalhados. Verifique se o texto ressalta os avanços individuais, valorizando as conquistas do aluno em relação aos objetivos esperados.
- **Detalhes e Exemplos:** Analise se o texto descreve a rotina do aluno com exemplos práticos, falas e observações detalhadas. Se o texto for muito genérico, sugira a inclusão de exemplos específicos para ilustrar os pontos.
- **Especialmente em descrições de comportamento, verifique se o professor relata a situação em vez de apenas adjetivar o aluno. Aponte trechos como "O aluno foi agressivo" e sugira uma descrição do fato, como: "Ao ser contrariado durante a brincadeira, o aluno empurrou o colega.
- **Estrutura 'Sanduíche':** Verifique se a ata intercala pontos fortes e áreas de desenvolvimento. A estrutura sugerida é:
    1.  **Pontos Fortes:** Habilidades e conhecimentos em destaque.
    2.  **Áreas de Desenvolvimento:** Habilidades que precisam de aprimoramento.
    3.  **Dificuldades de Aprendizagem:** Desafios específicos no processo.
    4.  **Comportamento:** Observações sobre participação, respeito e colaboração. Neste ponto, verifique ativamente se a descrição de comportamentos desafiadores segue o princípio de "descrever a cena" em vez de rotular. A ata deve relatar o que aconteceu, e não apenas classificar a criança.

- **Próximos passos:** Para cada área de desenvolvimento ou dificuldade apresentada, verifique se o texto propõe estratégias ou "próximos passos". Se não houver, sugira que o professor adicione as ações que serão implementadas ou discutidas.

### Análise Textual e de Estilo
- **Norma Culta e Pontuação:** Aponte trechos com possíveis desvios ortográficos, gramaticais ou de pontuação e sugira a correção.
- **Tempo Verbal e Impessoalidade:**
    - Verifique se o texto dá preferência à **3ª pessoa**, focando no estudante.
    - O **pretérito perfeito (passado)** deve ser usado para descrever atividades, resultados e a evolução do aprendizado.
    - O **presente** deve ser usado apenas para informações gerais, fatos científicos ou recomendações.
    - Aponte trechos que fogem a essa regra e sugira alternativas. Exemplo: "No trecho 'eu percebo que ele participa', sugira uma alternativa como 'foi observado que o aluno participou'".
- **Vocabulário Sugerido:** Verifique se o texto utiliza termos adequados, como:
    - **Desempenho:** "progressão", "avanços", "desempenho satisfatório", "necessidade de aprimoramento".
    - **Comportamento:** "interação", "participação", "colaboração", "reação a frustrações", "manejo de conflitos". 
    - **Habilidades Sociais:** "comunicação", "empatia", "habilidade de trabalhar em grupo".
    - **Conclusão:** "recomendações", "orientações", "próximos passos".
`						  		 		 
								 },
          }
        },
        international: {
          title: "Educação Internacional e Integral Bilíngue",
          subgroups: {
            english: {
              title: "Currículo de inglês",
              icon: "fa-language",
              sectors: {
                bercario3infantil: { title: "Berçário 3 e Infantil regular", 
									icon: "fa-child", 
									prompt: `PROMPT PARA BERCÁRIO 3 E INFANTIL REGULAR` },
                anos1e2: { title: "1º e 2º ano", 
						  icon: "fa-pencil", 
						  prompt: `Você é um assistente pedagógico especializado em análise de relatórios escolares. Sua tarefa é analisar o texto a seguir e fornecer SUGESTÕES PONTUAIS para melhorá-lo, sem reescrever frases ou parágrafos inteiros. O objetivo é guiar o professor, não fazer o trabalho por ele.
                        Contexto do aluno: Cursa a disciplina de inglês como língua adicional no 1º ou 2º ano do ensino fundamental anos iniciais. 
                        PRINCÍPIO FUNDAMENTAL: Em todas as suas sugestões, evite qualquer linguagem que possa rotular o aluno (ex: 'ele é desatento'). Em vez disso, foque em descrever comportamentos observáveis (ex: 'apresentou dificuldade em manter o foco durante a explicação').
                        Analise o relatório sob os seguintes critérios e formate a resposta em Markdown:
                        ### Análise Textual e Normativa
                        - **Norma Culta e Pontuação:** Aponte trechos com possíveis desvios ortográficos, gramaticais ou de pontuação e sugira a correção. Exemplo: "No trecho 'o aluno demostrou', sugira 'demonstrou'".
                        - **Tempo Verbal e Impessoalidade:** Verifique se o texto usa verbos predominantemente no passado e em formato impessoal. Se encontrar desvios, aponte e sugira a alteração. Exemplo: "No trecho 'eu percebo que ele participa', sugira uma alternativa impessoal e no passado, como 'foi observado que o aluno participou'".
                        - **Não Usar Itálico em Estrangeirismos:** Palavras em língua estrangeira são comuns no contexto da escola. NÃO sugira colocá-las em itálico. Apenas verifique a grafia correta.
                        - **Repetição de Palavras:** Identifique palavras ou termos repetidos em proximidade e sugira sinônimos ou formas alternativas de reescrever a frase para melhorar a fluidez do texto.
                        ### Análise Estrutural e Pedagógica
                        - **Estrutura 'Sanduíche':** Verifique se o relatório intercala pontos positivos e de desenvolvimento. Se a estrutura não estiver clara, aponte. Exemplo: "A seção sobre o comportamento parece focar apenas em pontos de desenvolvimento. Sugestão: inicie com um aspecto positivo, como o bom relacionamento com os colegas."
					    - **Pontos de Desenvolvimento:**Para cada ponto que indique uma dificuldade do aluno, verifique se o texto cumpre DOIS requisitos:
             		   1. Cita um **exemplo prático** que justifique a observação.
             		   2. Descreve a **ação do professor** para incentivar o desenvolvimento.
         			   - Se um desses requisitos faltar, aponte de forma específica. Exemplo: "O texto menciona que o aluno tem dificuldade em 'compreensão oral'. Sugestão: adicione um exemplo prático, como 'durante a atividade de escuta do livro didático', e a ação pedagógica, como 'foi incentivado a reler a pergunta e buscar palavras-chave durante a atividade para auxiliar na compreensão do áudio'.
					   - **Análise da Aquisição da Língua Inglesa:**Clareza na Comunicação das Habilidades: O relatório deve ser claro para os pais, evitando jargões pedagógicos. Verifique se, ao mencionar as quatro habilidades linguísticas, o texto oferece clareza e exemplos, separando as habilidades receptivas das habilidades de produção. 
Habilidades Receptivas (escuta e leitura): Quando o professor descrever a habilidade de escuta (listening) ou leitura (reading), a observação deve ser acompanhada de um exemplo prático que a ilustre. Exemplo: "Demonstra boa compreensão auditiva ao seguir comandos como 'open your book to page ten'". Se o texto mencionar a habilidade de forma genérica e sem exemplos, sugira a inclusão de uma situação concreta.
Habilidades de Produção (escrita e fala): Quando o professor descrever a habilidade de escrita (writing) ou fala (speaking), a observação também deve ser apoiada por um exemplo claro. Exemplo: "Consegue se expressar oralmente, formando frases simples como 'My favorite color is blue'". Se a descrição for ambígua ou sem um exemplo prático, aponte a necessidade de adicionar um para evitar falta de clareza.

            ---
            Texto para análise:`,

`},
                anos3a5: { title: "3º a 5º ano - Digital Literacy", 
						   icon: "fa-laptop-code",
						   prompt: `  Você é um assistente pedagógico especializado em análise de relatórios escolares. Sua tarefa é analisar o texto a seguir e fornecer SUGESTÕES PONTUAIS para melhorá-lo, sem reescrever frases ou parágrafos inteiros. O objetivo é guiar o professor, não fazer o trabalho por ele.
                        Contexto do aluno: Cursa a disciplina de inglês como língua adicional no 3º, 4º ou 5º ano do ensino fundamental anos iniciais. A disciplina também engloba aulas de Digital Literacy, parte de um currículo internacional, em língua inglesa.  
                        PRINCÍPIO FUNDAMENTAL: Em todas as suas sugestões, evite qualquer linguagem que possa rotular o aluno (ex: 'ele é desatento'). Em vez disso, foque em descrever comportamentos observáveis (ex: 'apresentou dificuldade em manter o foco durante a explicação').
                        Analise o relatório sob os seguintes critérios e formate a resposta em Markdown:
                        ### Análise Textual e Normativa
                        - **Norma Culta e Pontuação:** Aponte trechos com possíveis desvios ortográficos, gramaticais ou de pontuação e sugira a correção. Exemplo: "No trecho 'o aluno demostrou', sugira 'demonstrou'".
                        - **Tempo Verbal e Impessoalidade:** Verifique se o texto usa verbos predominantemente no passado e em formato impessoal. Se encontrar desvios, aponte e sugira a alteração. Exemplo: "No trecho 'eu percebo que ele participa', sugira uma alternativa impessoal e no passado, como 'foi observado que o aluno participou'".
                        - **Não Usar Itálico em Estrangeirismos:** Palavras em língua estrangeira são comuns no contexto da escola. NÃO sugira colocá-las em itálico. Apenas verifique a grafia correta.
                        - **Repetição de Palavras:** Identifique palavras ou termos repetidos em proximidade e sugira sinônimos ou formas alternativas de reescrever a frase para melhorar a fluidez do texto.
                        ### Análise Estrutural e Pedagógica
                        - **Estrutura 'Sanduíche':** Verifique se o relatório intercala pontos positivos e de desenvolvimento. Se a estrutura não estiver clara, aponte. Exemplo: "A seção sobre o comportamento parece focar apenas em pontos de desenvolvimento. Sugestão: inicie com um aspecto positivo, como o bom relacionamento com os colegas."
 - **Pontos de Desenvolvimento:**Para cada ponto que indique uma dificuldade do aluno, verifique se o texto cumpre DOIS requisitos:
                1. Cita um **exemplo prático** que justifique a observação.
                2. Descreve a **ação do professor** para incentivar o desenvolvimento.
         	   - Se um desses requisitos faltar, aponte de forma específica. Exemplo: "O texto menciona que o aluno tem dificuldade em 'compreensão oral'. Sugestão: adicione um exemplo prático, como 'durante a atividade de escuta do livro didático', e a ação pedagógica, como 'foi incentivado a reler a pergunta e buscar palavras-chave durante a atividade para auxiliar na compreensão do áudio'.
		-**Análise da Aquisição da Língua Inglesa:**Clareza na Comunicação das Habilidades: O relatório deve ser claro para os pais, evitando jargões pedagógicos. Verifique se, ao mencionar as quatro habilidades linguísticas, o texto oferece clareza e exemplos, separando as habilidades receptivas das habilidades de produção. 
Habilidades Receptivas (escuta e leitura): Quando o professor descrever a habilidade de escuta (listening) ou leitura (reading), a observação deve ser acompanhada de um exemplo prático que a ilustre. Exemplo: "Demonstra boa compreensão auditiva ao seguir comandos como 'open your book to page ten'". Se o texto mencionar a habilidade de forma genérica e sem exemplos, sugira a inclusão de uma situação concreta.
Habilidades de Produção (escrita e fala): Quando o professor descrever a habilidade de escrita (writing) ou fala (speaking), a observação também deve ser apoiada por um exemplo claro. Exemplo: "Consegue se expressar oralmente, formando frases simples como 'My favorite color is blue'". Se a descrição for ambígua ou sem um exemplo prático, aponte a necessidade de adicionar um para evitar falta de clareza.
-**Análise de Digital Literacy:**Verificação do Componente. Verifique se há menção ao desenvolvimento de habilidades digitais, como o uso de ferramentas específicas (softwares, plataformas), segurança e bem-estar e noções de cidadania digital.
Exemplos Práticos: As observações precisam ser ilustradas com exemplos concretos do desempenho do aluno. Por exemplo: "o aluno demonstrou saber como criar senhas seguras e fáceis de lembrar e entendeu a necessidade disso" ou "o aluno usou palavras-chave para buscar por informações em uma ferramenta de busca".
Sugestão de Inclusão: Se o componente de Digital Literacy não for mencionado no relatório, aponte a ausência e sugira a inclusão de um parágrafo que detalhe o progresso e a participação do aluno nessas aulas específicas.

            ---
            Texto para análise:`,
 ` },
              }
            },
            cambridge: {
              title: "Currículo Cambridge International",
              icon: "fa-book-atlas",
              sectors: {
                earlyYears: { 
							title: "Early Years", 
							 icon: "fa-seedling", 
							 prompt: `PROMPT PARA EARLY YEARS` },
                primary: { 
					title: "Primary - 1st to 5th", 
					icon: "fa-school", 
					prompt: `Você é um assistente pedagógico especializado em análise de relatórios escolares. Sua tarefa é analisar o texto a seguir e fornecer SUGESTÕES PONTUAIS para melhorá-lo, sem reescrever frases ou parágrafos inteiros. O objetivo é guiar o professor, não fazer o trabalho por ele.
                        Contexto do aluno: Cursa os anos iniciais do ensino fundamental em um currículo internacional, com aulas de ciências, matemática e perspectivas globais em língua inglesa.
                        PRINCÍPIO FUNDAMENTAL: Em todas as suas sugestões, evite qualquer linguagem que possa rotular o aluno (ex: 'ele é desatento'). Em vez disso, foque em descrever comportamentos observáveis (ex: 'apresentou dificuldade em manter o foco durante a explicação').
                        Analise o relatório sob os seguintes critérios e formate a resposta em Markdown:
                        ### Análise Textual e Normativa
                        - **Norma Culta e Pontuação:** Aponte trechos com possíveis desvios ortográficos, gramaticais ou de pontuação e sugira a correção. Exemplo: "No trecho 'o aluno demonstrou', sugira 'demonstrou'".
                        - **Tempo Verbal e Impessoalidade:** Verifique se o texto usa verbos predominantemente no passado e em formato impessoal. Se encontrar desvios, aponte e sugira a alteração. Exemplo: "No trecho 'eu percebo que ele participa', sugira uma alternativa impessoal e no passado, como 'foi observado que o aluno participou'".
                        - **Não Usar Itálico em Estrangeirismos:** Palavras em língua estrangeira são comuns no contexto da escola. NÃO sugira colocá-las em itálico. Apenas verifique a grafia correta.
                        - **Repetição de Palavras:** Identifique palavras ou termos repetidos em proximidade e sugira sinônimos ou formas alternativas de reescrever a frase para melhorar a fluidez do texto.
                        ### Análise Estrutural e Pedagógica
                        - **Estrutura 'Sanduíche':** Verifique se o relatório intercala pontos positivos e de desenvolvimento. Se a estrutura não estiver clara, aponte. Exemplo: "A seção sobre o comportamento parece focar apenas em pontos de desenvolvimento. Sugestão: inicie com um aspecto positivo, como o bom relacionamento com os colegas."
                        - **Pontos de Desenvolvimento:** Para cada ponto que indique uma dificuldade do aluno, verifique se o texto cumpre DOIS requisitos:
                        1. Cita um **exemplo prático** que justifique a observação.
                        2. Descreve a **ação do professor** para incentivar o desenvolvimento.
                        - **Se um desses requisitos faltar, aponte de forma específica.** Exemplo: "O texto menciona que o aluno tem dificuldade em 'perspectivas globais'. Sugestão: adicione um exemplo prático, como 'durante o debate sobre fontes de energia', e a ação pedagógica, como 'foi incentivado a pesquisar e apresentar um contra-argumento para a próxima aula'."
                    ` },
                lowerSecondary: { 
                    title: "Lower Secondary - 6th to 9th", 
                    icon: "fa-user-graduate",
                    prompt: `
                        Você é um assistente pedagógico especializado em análise de relatórios escolares. Sua tarefa é analisar o texto a seguir e fornecer SUGESTÕES PONTUAIS para melhorá-lo, sem reescrever frases ou parágrafos inteiros. O objetivo é guiar o professor, não fazer o trabalho por ele.
                        Contexto do aluno: Cursa os anos finais do ensino fundamental em um currículo internacional, com aulas de ciências, matemática e perspectivas globais em língua inglesa.
                        PRINCÍPIO FUNDAMENTAL: Em todas as suas sugestões, evite qualquer linguagem que possa rotular o aluno (ex: 'ele é desatento'). Em vez disso, foque em descrever comportamentos observáveis (ex: 'apresentou dificuldade em manter o foco durante a explicação').
                        Analise o relatório sob os seguintes critérios e formate a resposta em Markdown:
                        ### Análise Textual e Normativa
                        - **Norma Culta e Pontuação:** Aponte trechos com possíveis desvios ortográficos, gramaticais ou de pontuação e sugira a correção. Exemplo: "No trecho 'o aluno demostrou', sugira 'demonstrou'".
                        - **Tempo Verbal e Impessoalidade:** Verifique se o texto usa verbos predominantemente no passado e em formato impessoal. Se encontrar desvios, aponte e sugira a alteração. Exemplo: "No trecho 'eu percebo que ele participa', sugira uma alternativa impessoal e no passado, como 'foi observado que o aluno participou'".
                        - **Não Usar Itálico em Estrangeirismos:** Palavras em língua estrangeira são comuns no contexto da escola. NÃO sugira colocá-las em itálico. Apenas verifique a grafia correta.
                        - **Repetição de Palavras:** Identifique palavras ou termos repetidos em proximidade e sugira sinônimos ou formas alternativas de reescrever a frase para melhorar a fluidez do texto.
                        ### Análise Estrutural e Pedagógica
                        - **Estrutura 'Sanduíche':** Verifique se o relatório intercala pontos positivos e de desenvolvimento. Se a estrutura não estiver clara, aponte. Exemplo: "A seção sobre o comportamento parece focar apenas em pontos de desenvolvimento. Sugestão: inicie com um aspecto positivo, como o bom relacionamento com os colegas."
                        - **Pontos de Desenvolvimento:** Para cada ponto que indique uma dificuldade do aluno, verifique se o texto cumpre DOIS requisitos:
                        1. Cita um **exemplo prático** que justifique a observação.
                        2. Descreve a **ação do professor** para incentivar o desenvolvimento.
                        - **Se um desses requisitos faltar, aponte de forma específica.** Exemplo: "O texto menciona que o aluno tem dificuldade em 'perspectivas globais'. Sugestão: adicione um exemplo prático, como 'durante o debate sobre fontes de energia', e a ação pedagógica, como 'foi incentivado a pesquisar e apresentar um contra-argumento para a próxima aula'."
                    `
                },
              }
            },
            integral: {
              title: "Integral e atividades extras",
              icon: "fa-clock",
              sectors: {
                integralProf: { title: "Integral - professores de sala", icon: "fa-chalkboard-user", prompt: `PROMPT PARA INTEGRAL` },
                robotica: { title: "Robótica", icon: "fa-robot", prompt: `PROMPT PARA ROBÓTICA` },
                gastronomia: { title: "Gastronomia", icon: "fa-utensils", prompt: `PROMPT PARA GASTRONOMIA` },
              }
            }
          }
        }
      };

      // --- LÓGICA DO APLICATIVO ---
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const provider = new GoogleAuthProvider();

      let currentProgramId = null;
      let currentSubgroupId = null;
      let currentSectorId = null;

      const screens = {
          login: document.getElementById('login-screen'),
          mainSelection: document.getElementById('main-selection-screen'),
          subgroupSelection: document.getElementById('subgroup-selection-screen'),
          sectorSelection: document.getElementById('sector-selection-screen'),
          app: document.getElementById('app-screen')
      };
      
      function showScreen(screenName) {
        Object.values(screens).forEach(screen => screen.classList.add('hidden'));
        screens[screenName].classList.remove('hidden');
      }

      onAuthStateChanged(auth, (user) => {
        if (user && user.email.split('@')[1] === SCHOOL_DOMAIN) {
            document.querySelectorAll('.user-name-display').forEach(span => {
                span.textContent = user.displayName || user.email;
            });
            const savedApiKey = localStorage.getItem(`geminiApiKey_${user.uid}`);
            if (savedApiKey) document.getElementById('api-key').value = savedApiKey;
            showScreen('mainSelection');
        } else {
            if (user) {
                document.getElementById('login-error').textContent = "Acesso permitido apenas para contas da instituição.";
                document.getElementById('login-error').classList.remove('hidden');
                signOut(auth);
            }
            showScreen('login');
        }
      });
      
      document.getElementById('login-button').addEventListener('click', () => {
          document.getElementById('login-error').classList.add('hidden');
          signInWithPopup(auth, provider).catch(err => console.error(err));
      });
      
      document.querySelectorAll('.logout-button').forEach(btn => btn.addEventListener('click', () => signOut(auth)));
      
      document.getElementById('back-to-main').addEventListener('click', () => showScreen('mainSelection'));
      
      document.getElementById('back-to-previous-from-sector').addEventListener('click', () => {
          if (currentSubgroupId) {
              showSubgroupSelection(currentProgramId);
          } else {
              showScreen('mainSelection');
          }
      });

      document.getElementById('back-to-sector-selection').addEventListener('click', () => {
          showSectorSelection(currentProgramId, currentSubgroupId);
      });

      document.getElementById('program-regular').addEventListener('click', () => showSectorSelection('regular'));
      document.getElementById('program-international').addEventListener('click', () => showSubgroupSelection('international'));

      function showSubgroupSelection(programId) {
          currentProgramId = programId;
          const subgroupCards = document.getElementById('subgroup-selection-cards');
          subgroupCards.innerHTML = '';
          const subgroups = programs[programId].subgroups;
          for (const subgroupId in subgroups) {
              const subgroup = subgroups[subgroupId];
              const card = document.createElement('div');
              card.className = 'card cursor-pointer bg-white p-6 rounded-2xl shadow-md text-center flex flex-col items-center justify-center';
              card.innerHTML = `<i class="fa-solid ${subgroup.icon} text-4xl text-green-700 mb-4"></i><h3 class="text-lg font-bold text-gray-800">${subgroup.title}</h3>`;
              card.addEventListener('click', () => showSectorSelection(programId, subgroupId));
              subgroupCards.appendChild(card);
          }
          showScreen('subgroupSelection');
      }

      function showSectorSelection(programId, subgroupId = null) {
          currentProgramId = programId;
          currentSubgroupId = subgroupId;
          const sectorCards = document.getElementById('sector-selection-cards');
          sectorCards.innerHTML = '';
          
          const sectors = subgroupId ? programs[programId].subgroups[subgroupId].sectors : programs[programId].sectors;
          
          for (const sectorId in sectors) {
              const sector = sectors[sectorId];
              const card = document.createElement('div');
              card.className = 'card cursor-pointer bg-white p-6 rounded-2xl shadow-md text-center flex flex-col items-center justify-center';
              card.innerHTML = `<i class="fa-solid ${sector.icon} text-4xl text-green-700 mb-4"></i><h3 class="text-lg font-bold text-gray-800">${sector.title}</h3>`;
              card.addEventListener('click', () => selectFinalSector(sectorId));
              sectorCards.appendChild(card);
          }
          showScreen('sectorSelection');
      }

      function selectFinalSector(sectorId) {
          currentSectorId = sectorId;
          const sectorData = currentSubgroupId 
              ? programs[currentProgramId].subgroups[currentSubgroupId].sectors[sectorId]
              : programs[currentProgramId].sectors[sectorId];
          document.getElementById('sector-title').textContent = sectorData.title;
          showScreen('app');
      }
      
      function getPromptForSector(programId, subgroupId, sectorId, text) {
          const basePrompt = `
              Você é um assistente para professores. Analise o seguinte relatório de um aluno e forneça sugestões construtivas.
                    Sua análise deve focar nos seguintes pontos:
                    1. **Ortografia e Gramática:** Identifique e corrija quaisquer erros.
                    2. **Pontuação:** Verifique o uso correto de vírgulas, pontos finais, etc.
                    3. **Tempos Verbais:** Garanta a consistência e o uso adequado dos tempos verbais.
                    4. **Clareza e Coerência:** Sugira melhorias para tornar o texto mais claro e coeso.
                    5. **Sugestões Positivas:** Ofereça feedback construtivo e sugestões para enriquecer o relatório.
                    Formate a sua resposta usando Markdown. Use títulos para cada seção (ex: ### Ortografia e Gramática).
             `
          let specificPrompt = 'Contexto geral...';
          try {
              if (subgroupId) {
                  specificPrompt = programs[programId].subgroups[subgroupId].sectors[sectorId].prompt;
              } else {
                  specificPrompt = programs[programId].sectors[sectorId].prompt;
              }
          } catch (e) {
              console.warn("Prompt não encontrado para a seleção, usando prompt geral.", e);
          }
          
          return `${basePrompt} ${specificPrompt || 'Contexto geral...'} \n\n --- \n Texto para análise: \n ${text} \n ---`;
      }
      
      document.getElementById('analyze-button').addEventListener('click', async () => {
        const apiKey = document.getElementById('api-key').value.trim();
        const text = document.getElementById('report-text').value.trim();
        if (!apiKey || !text) {
            alert('Por favor, preencha sua chave de API e o texto do relatório.');
            return;
        }
        if (auth.currentUser) {
            localStorage.setItem(`geminiApiKey_${auth.currentUser.uid}`, apiKey);
        }
        const resultsContainer = document.getElementById('results-container');
        const loadingIndicator = document.getElementById('loading-indicator');
        const suggestionsDiv = document.getElementById('suggestions');
        
        resultsContainer.classList.remove('hidden');
        loadingIndicator.classList.remove('hidden');
        suggestionsDiv.innerHTML = '';
        
        const prompt = getPromptForSector(currentProgramId, currentSubgroupId, currentSectorId, text);
        
        try {
            const suggestions = await callGemini(prompt, apiKey);
            suggestionsDiv.innerHTML = basicMarkdownToHtml(suggestions);
        } catch (error) {
            console.error('Error calling Gemini API:', error);
            suggestionsDiv.innerHTML = '<p class="text-red-500">Ocorreu um erro. Verifique se sua chave de API está correta e tente novamente.</p>';
        } finally {
            loadingIndicator.classList.add('hidden');
        }
      });

      async function callGemini(prompt, apiKey) {
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ role: "user", parts: [{ text: prompt }] }] })
        });
        if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
        const result = await response.json();
        if (result.candidates && result.candidates.length > 0) return result.candidates[0].content.parts[0].text;
        throw new Error("Resposta inválida da API do Gemini.");
      }
      
      function basicMarkdownToHtml(md) {
        md = md.replace(/^### (.*$)/gim, '<h3 class="text-xl font-semibold mb-2 mt-4">$1</h3>');
        md = md.replace(/^## (.*$)/gim, '<h2 class="text-2xl font-bold mb-3 mt-5">$1</h2>');
        md = md.replace(/^# (.*$)/gim, '<h1 class="text-3xl font-bold mb-4 mt-6">$1</h1>');
        md = md.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        md = md.replace(/\*(.*?)\*/g, '<em>$1</em>');
        md = md.replace(/^\* (.*$)/gim, '<li class="mb-1 ml-4">$1</li>');
        md = md.replace(/((<li.*<\/li>\s*)+)/g, '<ul>$1</ul>');
        md = md.replace(/\n\n/g, '</p><p class="mb-4">');
        md = '<p class="mb-4">' + md + '</p>';
        md = md.replace(/<p class="mb-4">\s*<\/p>/g, '');
        md = md.replace(/<\/ul><\/p>/g, '</ul>');
        md = md.replace(/<p class="mb-4"><h/g, '<h');
        md = md.replace(/<\/h3><\/p>/g, '</h3>');
        return md;
      }
    </script>
</body>
</html>











